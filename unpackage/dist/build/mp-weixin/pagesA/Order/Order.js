(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesA/Order/Order"],{4146:function(e,t,o){"use strict";var a=function(e){e.options.wxsCallMethods||(e.options.wxsCallMethods=[])};t["a"]=a},"435d":function(e,t,o){"use strict";o.r(t);var a=o("de8d"),n=o("c756");for(var r in n)"default"!==r&&function(e){o.d(t,e,(function(){return n[e]}))}(r);o("ab6f");var i,d=o("f0c5"),s=o("4146"),u=Object(d["a"])(n["default"],a["b"],a["c"],!1,null,"c227da48",null,!1,a["a"],i);"function"===typeof s["a"]&&Object(s["a"])(u),t["default"]=u.exports},5625:function(e,t,o){},"5c48":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(o("b704")),n=o("2f62");function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function d(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){s(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var u={data:function(){var e;return e={btnkg:0,htmlReset:0,type:0,sku_id:"",sku_number:"",advocacy_user_id:"",dy_id:""},s(e,"advocacy_user_id",""),s(e,"use_dou",0),s(e,"g_data",""),s(e,"data_list",[]),s(e,"goods",[1,1]),s(e,"yunfei",[]),s(e,"yhlist",[]),s(e,"yhidx",0),s(e,"addresslist",[]),s(e,"paykg",!0),s(e,"address",""),s(e,"sum",1e3),s(e,"my_dou",100),s(e,"my_dou_xuan",!1),s(e,"zsum",1e3),s(e,"order_ls_data",""),s(e,"orderRemark",""),e},computed:d({},(0,n.mapState)(["hasLogin","loginMsg","wxlogin"])),onLoad:function(t){var o=this;e.showLoading({title:"正在加载中"}),e.setNavigationBarTitle({title:"正在加载中..."}),1==t.type?(o.type=t.type,o.sku_id=t.v_id,o.sku_number=t.number,o.dy_id=t.dy_id,o.advocacyviceId=t.advocacyviceId,o.advocacy_user_id=t.advocacy_user_id):(o.type=t.type,o.g_data=t.g_data),o.getdata()},onShow:function(){var e=this,t=getCurrentPages(),o=t[t.length-1];if(o.data.addresschose&&(this.address=o.data.addresschose,this.addressBack=!0,console.log(this.address,"地址")),o.data.yhlist_idx){var a=o.data.yhlist_idx,n=o.data.yh_idx;e.$set(e.order_ls_data[a],"yhidx",n)}if(o.data.invoice_idx){var r=o.data.invoice_idx,i=o.data.invoice;-1==i?e.$set(e.orderRemark[r],"invoice",""):e.$set(e.orderRemark[r],"invoice",i)}setTimeout((function(){e.jisuan()}),1e3)},onReady:function(){},onPullDownRefresh:function(){},methods:d(d({},(0,n.mapMutations)(["order_ls"])),{},{onRetry:function(){this.getdata()},getxj:function(e,t){var o=this;if(0!=o.data_list.length){var a=o.data_list[e].sum_price,n=0;o.yunfei[e]&&(n=o.yunfei[e].postage);var r=0;if(o.order_ls_data[e].yhidx>-1){var i=o.order_ls_data[e].coupon[o.order_ls_data[e].yhidx];if(1==i.coupon_setting_type&&(r=i.c_money),2==i.coupon_setting_type){var d=o.order_ls_data[e].goods;for(var s in d)if(i.coupon_use_obj_id==d[s].g_id){var u=d[s].price*i.discount_ratio/100;u=d[s].price-u}r=u}if(3==i.coupon_setting_type){d=o.order_ls_data[e].goods;for(var s in d)if(i.coupon_use_obj_id==d[s].g_id)u=d[s].price;r=u}}return"yh"==t?(console.log(r),r*=1,r=r.toFixed(2),"-￥"+r+"元"):(a=a-1*r+1*n,a>0&&(console.log(a),a*=1,a=a.toFixed(2)),o.$set(o.data_list[e],"js_price",a),a)}},getdata:function(){var t=this,o="/makeOrder/show",n={token:t.loginMsg.userToken};1==t.type&&(n={token:t.loginMsg.userToken,type:t.type,v_id:t.sku_id,number:t.sku_number}),2==t.type&&(n={token:t.loginMsg.userToken,type:t.type,g_data:t.g_data}),a.default.P_get(o,n).then((function(o){if(t.btn_kg=0,console.log(o),1==o.code){var a=o.data;"string"==typeof a&&(a=JSON.parse(a)),t.htmlReset=0,t.data_list=a,t.order_ls(a),t.order_ls_data=JSON.parse(JSON.stringify(a));var n={id:o.address.id,name:o.address.a_name,phone:o.address.a_phone,province:o.address.province,city:o.address.city,area:o.address.area,address:o.address.address};t.address=n,t.my_dou=o.common_data.bean,e.setNavigationBarTitle({title:"填写订单"});for(var r=[],i=0;i<a.length;i++){var d={group_code:a[i].group_code,remark:""};r.push(d)}t.orderRemark=r,t.jisuan(),console.log(n),t.getyf()}else t.htmlReset=1})).catch((function(o){t.btn_kg=0,t.htmlReset=1,console.log(o),e.showToast({icon:"none",title:"获取数据失败"})}))},getyf:function(){var t=this;if(t.address.id){for(var o="/makeOrder/calculatePrice",n=[],r=0;r<t.data_list.length;r++){var i={price:t.data_list[r].sum_price,number:t.data_list[r].sum_number,manager_id:t.data_list[r].group_code};n.push(i)}var d={token:t.loginMsg.userToken,data:JSON.stringify(n),address_id:t.address.id};a.default.P_get(o,d).then((function(e){if(t.btn_kg=0,console.log(e),1==e.code){var o=e.data;"string"==typeof o&&(o=JSON.parse(o)),t.yunfei=o,t.jisuan()}})).catch((function(o){t.btn_kg=0,console.log(o),e.showToast({icon:"none",title:"获取数据失败"})}))}},select:function(){var e=this;e.my_dou_xuan=!e.my_dou_xuan,e.jisuan()},jisuan:function(){for(var e=this,t=0,o=0;o<e.data_list.length;o++)e.data_list[o].js_price||0==e.data_list[o].js_price?t+=1*e.data_list[o].js_price:t+=1*e.data_list[o].sum_price;if(e.my_dou_xuan){var a=1*e.my_dou,n=1*e.my_dou;t>a/100?(t-=a/100,e.use_dou=a,n=0):(n=a-100*t,e.use_dou=100*t,t=0),console.log("我的代言豆还有："+n+"个")}else e.use_dou=0;e.zsum=t.toFixed(2)},countpri:function(){var e=0,t=this.xzarr;for(var o in t)e+=t[o].num*(100*t[o].goods_real_price);console.log(e),e=(e/100).toFixed(0),this.sum=e},subbtn:function(){var t=this,o=JSON.parse(JSON.stringify(t.orderRemark));if(console.log(o),null!=t.address&&""!=t.address.id&&void 0!=t.address.id){for(var n,r="/makeOrder",i=[],d=0;d<t.order_ls_data.length;d++){var s;-1!=t.order_ls_data[d].yhidx&&(s={manager_id:t.order_ls_data[d].group_code,coupon_list_id:t.order_ls_data[d].coupon[t.order_ls_data[d].yhidx].id},i.push(s))}i=0==i.length?"":JSON.stringify(i);o=JSON.stringify(t.orderRemark);1==t.type&&(n={token:t.loginMsg.userToken,type:t.type,v_id:t.sku_id,address_id:t.address.id,advocacy_bean:t.use_dou,advocacyId:t.dy_id,advocacyviceId:t.advocacyviceId,advocacy_user_id:t.advocacy_user_id,number:t.sku_number,coupon_list:i,orderRemark:o}),2==t.type&&(n={token:t.loginMsg.userToken,type:t.type,address_id:t.address.id,advocacy_bean:t.use_dou,g_data:t.g_data,coupon_list:i,orderRemark:o}),console.log(n),1!=t.btnkg&&(t.btnkg=1,a.default.P_post(r,n).then((function(o){if(t.btnkg=0,console.log(o),1001==o.code)return e.showToast({icon:"none",title:"购买成功"}),a.default.get_info(),void setTimeout((function(){e.hideLoading(),t.btnkg=0,e.redirectTo({url:"/pagesA/OrderList/OrderList?type=5"})}),1e3);if(1==o.code){var n=o.data;console.log(typeof n),"string"==typeof n&&(n=JSON.parse(n)),a.default.wxpay(o.data).then((function(t){e.showToast({icon:"none",title:"购买成功"}),a.default.get_info(),setTimeout((function(){e.redirectTo({url:"/pagesA/OrderList/OrderList?type=5"})}),1e3)})).catch((function(o){t.btn_kg=0,e.showToast({icon:"none",title:"微信支付失败"}),setTimeout((function(){e.redirectTo({url:"/pagesA/OrderList/OrderList"})}),1e3)}))}})).catch((function(o){t.btnkg=0,console.log(o),e.showToast({icon:"none",title:"获取数据失败"})})))}else wx.showToast({icon:"none",title:"请先添加地址"})},goaddress:function(){a.default.goaddress()},jump:function(e){var t=this;1!=t.btnkg&&(t.btnkg=1,setTimeout((function(){t.btnkg=0}),1e3),a.default.jump(e))}})};t.default=u}).call(this,o("543d")["default"])},ab6f:function(e,t,o){"use strict";var a=o("5625"),n=o.n(a);n.a},c756:function(e,t,o){"use strict";o.r(t);var a=o("5c48"),n=o.n(a);for(var r in a)"default"!==r&&function(e){o.d(t,e,(function(){return a[e]}))}(r);t["default"]=n.a},de8d:function(e,t,o){"use strict";var a;o.d(t,"b",(function(){return n})),o.d(t,"c",(function(){return r})),o.d(t,"a",(function(){return a}));var n=function(){var e=this,t=e.$createElement,o=(e._self._c,e.data_list.length>0?e.__map(e.data_list,(function(t,o){var a=e.__get_orig(t),n=0!=t.coupon.length&&-1!=e.order_ls_data[o].yhidx?e.getxj(o,"yh"):null,r=1==t.is_make_plain_invoice||1==t.is_make_special_invoice?JSON.stringify(e.orderRemark[o]):null,i=e.getxj(o);return{$orig:a,m0:n,g0:r,m1:i}})):null);e.$mp.data=Object.assign({},{$root:{l0:o}})},r=[]},f872:function(e,t,o){"use strict";(function(e){o("72bd");a(o("66fd"));var t=a(o("435d"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])}},[["f872","common/runtime","common/vendor"]]]);