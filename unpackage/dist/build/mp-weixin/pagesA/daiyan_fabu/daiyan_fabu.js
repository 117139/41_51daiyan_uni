(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesA/daiyan_fabu/daiyan_fabu"],{"10e2":function(t,e,n){"use strict";n.r(e);var o=n("5021"),a=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,(function(){return o[t]}))}(i);e["default"]=a.a},"15b0":function(t,e,n){"use strict";var o=function(t){t.options.wxsCallMethods||(t.options.wxsCallMethods=[])};e["a"]=o},"33f0":function(t,e,n){"use strict";n.r(e);var o=n("5a43"),a=n("10e2");for(var i in a)"default"!==i&&function(t){n.d(e,t,(function(){return a[t]}))}(i);n("5b2d");var s,r=n("f0c5"),l=n("15b0"),c=Object(r["a"])(a["default"],o["b"],o["c"],!1,null,"0f9d3114",null,!1,o["a"],s);"function"===typeof l["a"]&&Object(l["a"])(c),e["default"]=c.exports},"3f42":function(t,e,n){},5021:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=l(n("a34a")),a=l(n("b704")),i=n("2f62"),s=l(n("02ed")),r=n("5ded");function l(t){return t&&t.__esModule?t:{default:t}}function c(t,e,n,o,a,i,s){try{var r=t[i](s),l=r.value}catch(c){return void n(c)}r.done?e(l):Promise.resolve(l).then(o,a)}function u(t){return function(){var e=this,n=arguments;return new Promise((function(o,a){var i=t.apply(e,n);function s(t){c(i,o,a,s,r,"next",t)}function r(t){c(i,o,a,s,r,"throw",t)}s(void 0)}))}}function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function g(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){f(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function f(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var h,p=n("14bc"),m=(p.wxml,p.style,{data:function(){return{btnkg:0,xy_datas:"",htmlReset:0,datalist:["图片代言","视频代言","海报代言"],src:"",type:1,pages:[1,1,1,1,1],data_list:[1,1,1,1,1,1],open_type:1,yname:"",imgb:[],sp_url:"",haibao:"haibao.png",goods_sele:[[{num:1,xuan:!1},{num:1,xuan:!1}],[{num:1,xuan:!1},{num:1,xuan:!1}]],xuan:!1,all:!1,width:750,height:1334,sheetshow:!0,xdxy_type:1,moban_list:[{url:"/static_s/51daiyan/images/hb_moban1.jpg",url_bg:"/static_s/51daiyan/images/hbbg.jpg",dx:254,dy:494,width:244,height:244},{url:"/static_s/51daiyan/images/hb_moban2.jpg",url_bg:"/static_s/51daiyan/images/hdhb1.jpg",dx:270,dy:572,width:208,height:208},{url:"/static_s/51daiyan/images/hb_moban3.jpg",url_bg:"/static_s/51daiyan/images/hdhb2.jpg",dx:283,dy:517,width:208,height:208}],mb_cur:0,poster:{width:750,height:1334},qrShow:!1,canvasId:"default_PosterCanvasId",count:0,exceed_number_bl:0}},computed:g({},(0,i.mapState)(["hasLogin","loginMsg","dy_fb_list","ov_ids"])),onLoad:function(e){h=this,this.sheetshow_fuc(),e.type&&(h.type=e.type),this.exceed_number_bl=t.getStorageSync("exceed_number_bl")||0,this.getdata_xy(),h.widget=h.selectComponent(".widget")},onShow:function(){var t=1,e=[1,1];this.goods=e,this.pages=t,1==this.btnkg&&(h.btnkg=0),console.log("我显示了")},methods:{getimg:function(t){return a.default.getimg(t)},getdata_xy:function(){var e=this,n={keyword:"dyxy"};a.default.P_get("/getClause",n).then((function(t){console.log(t),1==t.code&&(e.xy_datas=t.data)})).catch((function(e){console.log(e),t.showToast({icon:"none",title:"获取数据失败"})}))},xdxy_type_fuc:function(){this.xdxy_type=1==this.xdxy_type?0:1},sheetshow_fuc:function(){this.sheetshow=!0,this.btnkg=0,this.$refs.popup.open()},tkchange:function(t){console.log(t),this.sheetshow=t.show},onClose:function(){this.sheetshow=!1,this.$refs.popup.close(),0==this.xdxy_type&&t.navigateBack({delta:1})},open_more:function(){this.open_type=1e4},cload:function(){var t=1,e=[1,1];this.data.goods=e,this.pages=t,console.log("我显示了")},onReady:function(){},onPullDownRefresh:function(){wx.stopPullDownRefresh()},bindcur:function(t){var e=this;console.log(t.currentTarget.dataset.type),e.type=t.currentTarget.dataset.type},chooseVideo:function(){var e=this;t.showActionSheet({itemList:["拍摄","相册"],success:function(n){console.log("选中了第"+(n.tapIndex+1)+"个按钮");var o=["camera","album"];o=0==n.tapIndex?["camera"]:["album"],t.chooseVideo({count:1,sizeType:["original","compressed"],sourceType:o,success:function(t){console.log(t),e.uploadvideo(t)}})},fail:function(e){t.showToast({icon:"none",title:"操作失败"}),console.log(e.errMsg)}})},uploadvideo:function(e){var n=this,o=t.uploadFile({url:a.default.IPurl+"/upload/upVvideo",filePath:e.tempFilePath,name:"file",formData:{},success:function(t){if(console.log("视频上传成功"),console.log,"string"==typeof t.data)var e=JSON.parse(t.data);else e=t.data;1==e.code?(n.sp_url=e.msg,wx.showToast({icon:"none",title:"上传成功"})):e.msg?wx.showToast({icon:"none",title:e.msg}):wx.showToast({icon:"none",title:"上传失败"})},fail:function(){t.hideLoading(),wx.showToast({icon:"none",title:"上传失败"}),console.log("接口调用失败")}});o.onProgressUpdate((function(e){console.log("上传进度"+e.progress),console.log("已经上传的数据长度"+e.totalBytesSent),console.log("预期需要上传的数据总长度"+e.totalBytesExpectedToSend),t.showLoading({mask:"true",title:"正在上传视频"}),100==e.progress&&t.showLoading({mask:"true",title:"正在校验视频"})}))},save_val:function(){var e=this,n=e.type,o="";if(1==n){if(0==e.imgb.length)return void wx.showToast({icon:"none",title:"请上传商品图片"});o=e.imgb.join(",")}if(2==n){if(!e.sp_url)return void wx.showToast({icon:"none",title:"请上传商品视频"});o=e.sp_url}if(3==n){if(!e.src)return void wx.showToast({icon:"none",title:"请生成海报"});o=e.src}var i="/advocacy/add",s={token:e.loginMsg.userToken,ov_ids:e.ov_ids,content:e.yname,path:o,type:e.type};1!=e.btnkg&&(e.btnkg=1,a.default.post(i,s,(function(n){if(e.btnkg=0,1==n.data.code){var a=n.data.data;"string"==typeof a&&(a=JSON.parse(a)),wx.showToast({title:"操作成功"}),setTimeout((function(){wx.redirectTo({url:"/pagesA/daiyan_fabu_ok/daiyan_fabu_ok?activity_id="+e.dy_fb_list[0].activity_id+"&type="+e.type+"&path="+o})}),1e3)}else n.data.msg?t.showToast({icon:"none",title:n.data.msg}):t.showToast({icon:"none",title:"操作失败"})}),(function(n){e.btnkg=0,t.showToast({icon:"none",title:"操作失败"})})))},get_val:function(t){console.log(t.detail),this.yname=t.detail.value},imgdel:function(t){var e=this;console.log(t.currentTarget.dataset.idx),wx.showModal({title:"提示",content:"确定要删除这张图片吗",success:function(n){n.confirm?(console.log("用户点击确定"),e.imgb.splice(t.currentTarget.dataset.idx,1),e.imgb=e.imgb):n.cancel&&console.log("用户点击取消")}})},scpic:function(){var e=this,n=9-e.imgb.length;t.showActionSheet({itemList:["拍照","相册"],success:function(o){console.log("选中了第"+(o.tapIndex+1)+"个按钮");var a=["camera","album"];a=0==o.tapIndex?["camera"]:["album"],t.chooseImage({count:n,sizeType:["original","compressed"],sourceType:a,success:function(t){console.log(t);var n=t.tempFilePaths,o=e.imgb.length;9!=o?e.upimg(n,0):wx.showToast({icon:"none",title:"最多可上传九张"})}})},fail:function(e){t.showToast({icon:"none",title:"操作失败"}),console.log(e.errMsg)}})},upimg:function(t,e){var n=this,o=n.imgb.length;Number(o),Number(e);9!=o?wx.uploadFile({url:a.default.IPurl+"/upload/streamImg",filePath:t[e],name:"file",formData:{type:1},success:function(o){var a=JSON.parse(o.data);if(1==a.code){console.log(t[e],e,a.msg);var i=n.imgb;console.log(e),i.push(a.msg),n.imgb=i;var s=n.imgb.length;s<9&&e<t.length-1&&(e++,n.upimg(t,e))}else a.msg?wx.showToast({icon:"none",title:a.msg}):wx.showToast({icon:"none",title:"上传失败"})},fail:function(t){console.log(t),wx.showToast({icon:"none",title:"上传失败"})}}):wx.showToast({icon:"none",title:"最多可上传九张"})},pay:function(t){var e=this,n=t.currentTarget.dataset.code;1!=e.data.btnkg&&(e.setData({btnkg:1}),app.Pay(n,"info"))},jump:function(t){a.default.jump(t)},onRetry:function(){this.onLoad()},shareFc:function(){var t=this;return u(o.default.mark((function e(){var n,i;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t,e.prev=1,t.count++,s.default.log("准备生成:"+new Date),e.next=6,(0,r.getSharePoster)({_this:n,type:"testShareType",backgroundImage:a.default.imgurl+h.moban_list[h.mb_cur].url_bg,formData:{},posterCanvasId:n.canvasId,delayTimeScale:20,setCanvasWH:function(t){var e=t.bgObj;n.poster=e},drawArray:function(t){t.bgObj,t.type,t.bgScale,t.setBgObj;var e=t.getBgObj;return[{type:"image",id:"productImage",url:h.loginMsg.personal_code,dx:h.moban_list[h.mb_cur].dx,dy:h.moban_list[h.mb_cur].dy,serialNum:0,circleSet:!0,infoCallBack:function(t){var e,n;return e=h.moban_list[h.mb_cur].width,n=h.moban_list[h.mb_cur].height,{dWidth:e,dHeight:n}}},{type:"image",id:"userImage",url:n.loginMsg.avatarurl,dx:100,dy:900,serialNum:0,infoCallBack:function(t){var e,n;return e=120,n=120,{dWidth:e,dHeight:n,circleSet:!0}}},{type:"text",id:"productName",text:n.loginMsg.nickname,color:"#000",serialNum:1,allInfoCallback:function(t){var n=t.drawArray,o=n.find((function(t){return"productImage"===t.id}));e().height,o.dHeight;return{size:30,textAlign:"center",lineFeed:{maxWidth:120,lineNum:1},dx:152,dy:1044}}},{type:"text",id:"userLv",text:n.loginMsg.advocacy_grade_value,color:"#000",serialNum:1,allInfoCallback:function(t){var n=t.drawArray,o=n.find((function(t){return"productImage"===t.id}));e().height,o.dHeight;return{size:20,color:"#FE8735",lineFeed:{maxWidth:120,lineNum:1},dx:210,dy:1080}}},{type:"text",text:n.loginMsg.advocacy_goods_number+"件",serialNum:3,allInfoCallback:function(t){t.drawArray;return{size:30,color:"#FE8735",textAlign:"center",lineFeed:{maxWidth:200,lineNum:1},dx:150,dy:1210}}},{type:"text",text:n.loginMsg.follow_buy_goods_number+"件",serialNum:3,allInfoCallback:function(t){t.drawArray;return{size:30,color:"#FE8735",textAlign:"center",lineFeed:{maxWidth:200,lineNum:1},dx:360,dy:1210}}},{type:"text",text:n.exceed_number_bl+"%好友",serialNum:3,allInfoCallback:function(t){t.drawArray;return{size:30,color:"#FE8735",textAlign:"center",lineFeed:{maxWidth:200,lineNum:1},dx:585,dy:1210}}}]}});case 6:i=e.sent,s.default.log("海报生成成功, 时间:"+new Date+"， 临时路径: "+i.poster.tempFilePath),n.poster.finalPath=i.poster.tempFilePath,n.qrShow=!0,n.src=i.poster.tempFilePath,wx.uploadFile({url:a.default.IPurl+"/upload/streamImg",filePath:i.poster.tempFilePath,name:"file",formData:{type:1},success:function(t){var e=JSON.parse(t.data);1==e.code?(n.src=e.msg,n.poster.finalPath=a.default.imgurl+e.msg,wx.showToast({icon:"none",title:"上传成功"})):wx.showToast({icon:"none",title:"上传失败"})}}),e.next=19;break;case 14:e.prev=14,e.t0=e["catch"](1),s.default.hideLoading(),s.default.showToast(JSON.stringify(e.t0)),console.log(JSON.stringify(e.t0));case 19:case"end":return e.stop()}}),e,null,[[1,14]])})))()},saveImage:function(){t.showModal({title:"提示",content:"是否保存",success:function(e){e.confirm?(console.log("用户点击确定"),t.downloadFile({url:h.poster.finalPath,success:function(e){200===e.statusCode&&(console.log("下载成功"),t.hideLoading(),t.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(e){t.showToast({title:"保存成功"})},fail:function(e){console.log(e),t.showToast({title:e})}}))}})):e.cancel&&console.log("用户点击取消")}})},share:function(){s.default.showToast("分享了")},hideQr:function(){this.qrShow=!1}}});e.default=m}).call(this,n("543d")["default"])},"5a43":function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o}));var o={uniPopup:function(){return Promise.all([n.e("common/vendor"),n.e("components/uni-popup/uni-popup")]).then(n.bind(null,"f66d"))}},a=function(){var t=this,e=t.$createElement,n=(t._self._c,0==t.htmlReset?t.__map(t.moban_list,(function(e,n){var o=t.__get_orig(e),a=t.getimg(e.url);return{$orig:o,m0:a}})):null);t._isMounted||(t.e0=function(e){t.open_type=1},t.e1=function(e,n){var o=arguments[arguments.length-1].currentTarget.dataset,a=o.eventParams||o["event-params"];n=a.index;t.mb_cur=n}),t.$mp.data=Object.assign({},{$root:{l0:n}})},i=[]},"5b2d":function(t,e,n){"use strict";var o=n("3f42"),a=n.n(o);a.a},d905:function(t,e,n){"use strict";(function(t){n("72bd");o(n("66fd"));var e=o(n("33f0"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])}},[["d905","common/runtime","common/vendor"]]]);