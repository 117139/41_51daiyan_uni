{"version":3,"sources":["uni-app:///main.js","webpack:///E:/phpStudy/WWW/41_51daiyan_uni/pages/tim/room.vue?50cc","webpack:///E:/phpStudy/WWW/41_51daiyan_uni/pages/tim/room.vue?9b03","webpack:///E:/phpStudy/WWW/41_51daiyan_uni/pages/tim/room.vue?1876","webpack:///E:/phpStudy/WWW/41_51daiyan_uni/pages/tim/room.vue?26fd","uni-app:///pages/tim/room.vue","webpack:///E:/phpStudy/WWW/41_51daiyan_uni/pages/tim/room.vue?a2a5","webpack:///E:/phpStudy/WWW/41_51daiyan_uni/utils/filter.wxs?2840","webpack:///E:/phpStudy/WWW/41_51daiyan_uni/utils/filter.wxs?26a6"],"names":["createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","l0","_self","_c","__map","msgList","item","index","m0","nodesFliter","payload","text","m1","getarg","extension","data","m2","m3","m4","m5","m6","m7","m8","m9","m10","timeFliter","time","m11","gettime1","m12","m13","m14","m15","m16","m17","m18","m19","m20","m21","$orig","__get_orig","_isMounted","e0","$event","isFocus","e1","$mp","Object","assign","$root","recyclableRender","staticRenderFns","_withStripped","Component","wxsCallMethods"],"mappings":"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FAEA,gBACA,iBACA,SACA,UACA,UACA,cACA,YAIA,sBACA,cACA,qBACA,mBACA,gBAGA,YAGA,eACA,eACA,oBACA,oBACA,+DAGA,OACA,mBADA,SACA,KACA,eACA,sBAGA,OAvFA,SAuFA,cACA,kBACA,gBAOA,mDACA,6DACA,mBAGA,cACA,kBAEA,gCACA,oBAIA,mCACA,oBAGA,kCACA,oBAIA,OAtHA,WAuHA,WACA,YACA,uBACA,mBACA,2BACA,wBACA,MAEA,SA/HA,WAiIA,uFACA,oBACA,uBAEA,mBAEA,4CAGA,kBA1IA,WA2IA,yBAEA,SACA,OADA,WAEA,WACA,GACA,2BACA,eAIA,8CACA,eACA,YACA,oBACA,yBACA,wBAGA,mBACA,eACA,aACA,YACA,uBAIA,SAzBA,SAyBA,GACA,WAGA,mBACA,2BACA,yBAEA,OADA,qDACA,yCACA,yBADA,IAIA,KArCA,SAqCA,GACA,eACA,cACA,mCAGA,6BACA,yBAGA,eA/CA,WAgDA,aACA,iBACA,qBAIA,OAtDA,SAsDA,OACA,gBAGA,GAIA,cACA,kBAEA,oBAEA,2BAGA,UAHA,IAOA,YA1EA,SA0EA,GACA,2FACA,UAGA,WA/EA,SA+EA,GACA,sBACA,iCACA,UAEA,YApFA,SAoFA,GACA,MAGA,+BACA,0BACA,uBACA,gBACA,kBACA,kBACA,iBACA,cACA,eACA,iBAOA,OANA,OACA,SAGA,eAEA,KAGA,WAEA,QAIA,oBAEA,4BAIA,UAvHA,SAuHA,gBACA,cACA,2CAEA,0BACA,0DAKA,mEAGA,qBAEA,mFAIA,YA1IA,SA0IA,cACA,yBAEA,6CACA,sGACA,oBACA,gEACA,2CACA,iCACA,0BAaA,WAhKA,WAgKA,WAEA,yCACA,+DACA,oBACA,oBACA,0BAGA,6DACA,2CACA,iCACA,sEAGA,2BAEA,oBACA,2BACA,+BAKA,WAxLA,SAwLA,GAEA,oBACA,gBACA,iBACA,cACA,cACA,cAEA,UAGA,SApMA,WAqMA,gBACA,kBACA,eACA,iBACA,mBAEA,mBAIA,WA/MA,WAgNA,kCAGA,WAnNA,WAmNA,WACA,wBACA,uBACA,cACA,iBACA,MAGA,YA3NA,WA4NA,wBAGA,OA/NA,WAgOA,yBAGA,iBAnOA,WAoOA,cACA,wBAEA,mBAGA,SA1OA,SA0OA,GACA,WACA,eACA,eACA,eACA,mCACA,QACA,oBACA,uBAkBA,YApQA,WAqQA,iBACA,gBACA,kBACA,mBAEA,mBAIA,SA9QA,SA8QA,GACA,qBAIA,cAnRA,WAoRA,qDACA,mBAIA,SAzRA,WA2RA,GADA,kBACA,cAGA,sCACA,WACA,uBACA,kBAGA,aApSA,SAoSA,cACA,gDACA,wBACA,qCAEA,IADA,qBACA,oBACA,WACA,aAGA,oEAEA,4CAEA,OADA,0BACA,OAKA,UAIA,QA3TA,SA2TA,SAEA,EAFA,OACA,oBAEA,eAEA,EADA,YACA,8BACA,iBACA,uBACA,SACA,YACA,0BACA,yBAGA,SACA,6BACA,iBACA,uBACA,SACA,UAIA,4BACA,iBACA,uBACA,SACA,eAKA,qBACA,+CACA,8BACA,QACA,YACA,wBAEA,iCACA,yBAGA,YACA,mBAMA,WA7WA,SA6WA,GACA,sBAGA,YAjXA,SAiXA,GACA,sBAGA,UArXA,SAqXA,GACA,6CACA,wCACA,sBAEA,kBA1XA,SA0XA,GACA,sBAGA,iBA9XA,SA8XA,GACA,sBAGA,wBAlYA,SAkYA,GACA,sBAGA,gBAtYA,SAsYA,gBACA,gBACA,eACA,iBAEA,yBAEA,uBAEA,KACA,mBACA,MACA,WACA,oCACA,qBACA,cAGA,mBACA,MACA,eACA,sCACA,gBACA,cAEA,uBAEA,sGACA,kEACA,yCAGA,gBACA,wBAEA,MAIA,iBA7aA,WA6aA,WACA,yBACA,uBACA,oBACA,MAEA,cAnbA,SAmbA,KACA,iDACA,IACA,kDACA,mBAGA,UA1bA,SA0bA,GACA,cACA,sCAIA,QAhcA,SAgcA,GACA,gBACA,iBACA,sBACA,wBAIA,UAxcA,SAwcA,GACA,oBACA,6BACA,2BACA,sBAIA,WAhdA,SAgdA,GACA,qBAGA,sCACA,kDACA,sCAGA,YAzdA,SAydA,cACA,kBACA,sBACA,oBACA,yCACA,mBACA,MAGA,YAleA,WAmeA,kBACA,sBACA,2BACA,iBACA,sBAGA,SA1eA,SA0eA,GACA,mBAGA,mBAEA,2CACA,iBACA,6BAEA,iBACA,8BAIA,SAzfA,SAyfA,GACA,iBAGA,kBACA,sBACA,2BACA,uBAGA,UAngBA,SAmgBA,GAEA,GADA,gCACA,cAaA,0BAbA,CACA,qCACA,OACA,SACA,oBAEA,iCACA,uBACA,eACA,eACA,iBACA,wBAIA,kBAGA,YAvhBA,WAwhBA,kBACA,4BAEA,QA3hBA,aA8hBA,YA9hBA,WA+hBA,WACA,aACA,WACA,oBACA,oBACA,cACA,sBACA,OACA,MACA,QACA,wBACA,gEAEA,oBACA,OACA,mBACA,yBACA,aAEA,2BACA,UACA,0BAOA,YA3jBA,WA4jBA,kBACA,gBACA,mBACA,qBAEA,QAjkBA,SAikBA,GACA,eACA,SACA,oCAEA,gBACA,OACA,kBACA,+BACA,oBACA,8DAEA,iBACA,6B;;;;2DCp8BA,8rCAAipC,eAAG,G;;;;;;;;6DCAppC,0SAA4T,2B;;;;6DCA5T,OAAe,yBACJC,EAAU5D,QAAQ6D,iBACpBD,EAAU5D,QAAQ6D,eAAiB,O","file":"pages/tim/room.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/tim/room.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./room.vue?vue&type=template&id=48d0d46b&filter-modules=eyJmaWx0ZXIiOnsidHlwZSI6InNjcmlwdCIsImNvbnRlbnQiOiIiLCJzdGFydCI6MTAwODQsImF0dHJzIjp7Im1vZHVsZSI6ImZpbHRlciIsImxhbmciOiJ3eHMiLCJzcmMiOiIuLi8uLi91dGlscy9maWx0ZXIud3hzIn0sImVuZCI6MTAwODR9fQ%3D%3D&\"\nvar renderjs\nimport script from \"./room.vue?vue&type=script&lang=js&\"\nexport * from \"./room.vue?vue&type=script&lang=js&\"\nimport style0 from \"./room.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\n/* custom blocks */\nimport block0 from \"../../utils/filter.wxs?vue&type=custom&index=0&blockType=script&issuerPath=E%3A%5CphpStudy%5CWWW%5C41_51daiyan_uni%5Cpages%5Ctim%5Croom.vue&module=filter&lang=wxs\"\nif (typeof block0 === 'function') block0(component)\n\ncomponent.options.__file = \"pages/tim/room.vue\"\nexport default component.exports","export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./room.vue?vue&type=template&id=48d0d46b&filter-modules=eyJmaWx0ZXIiOnsidHlwZSI6InNjcmlwdCIsImNvbnRlbnQiOiIiLCJzdGFydCI6MTAwODQsImF0dHJzIjp7Im1vZHVsZSI6ImZpbHRlciIsImxhbmciOiJ3eHMiLCJzcmMiOiIuLi8uLi91dGlscy9maWx0ZXIud3hzIn0sImVuZCI6MTAwODR9fQ%3D%3D&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.msgList, function(item, index) {\n    var m0 = _vm.nodesFliter(item.payload.text)\n    var m1 = _vm.getarg(item.payload.extension, \"a\", item.payload.data)\n    var m2 = _vm.getarg(item.payload.extension, \"a1\", item.payload.data)\n    var m3 = _vm.getarg(item.payload.extension, \"a2\", item.payload.data)\n    var m4 = _vm.getarg(item.payload.extension, \"a3\", item.payload.data)\n    var m5 = _vm.getarg(item.payload.extension, \"a2\", item.payload.data)\n    var m6 = _vm.getarg(item.payload.extension, \"a3\", item.payload.data)\n    var m7 = _vm.getarg(item.payload.extension, \"a\", item.payload.data)\n    var m8 = _vm.getarg(item.payload.extension, \"a1\", item.payload.data)\n    var m9 = _vm.getarg(item.payload.extension, \"a2\", item.payload.data)\n    var m10 = _vm.timeFliter(item.time)\n    var m11 = _vm.gettime1(index - 1)\n    var m12 = _vm.nodesFliter(item.payload.text)\n    var m13 = _vm.getarg(item.payload.extension, \"a\", item.payload.data)\n    var m14 = _vm.getarg(item.payload.extension, \"a1\", item.payload.data)\n    var m15 = _vm.getarg(item.payload.extension, \"a2\", item.payload.data)\n    var m16 = _vm.getarg(item.payload.extension, \"a3\", item.payload.data)\n    var m17 = _vm.getarg(item.payload.extension, \"a2\", item.payload.data)\n    var m18 = _vm.getarg(item.payload.extension, \"a3\", item.payload.data)\n    var m19 = _vm.getarg(item.payload.extension, \"a\", item.payload.data)\n    var m20 = _vm.getarg(item.payload.extension, \"a1\", item.payload.data)\n    var m21 = _vm.getarg(item.payload.extension, \"a2\", item.payload.data)\n    return {\n      $orig: _vm.__get_orig(item),\n      m0: m0,\n      m1: m1,\n      m2: m2,\n      m3: m3,\n      m4: m4,\n      m5: m5,\n      m6: m6,\n      m7: m7,\n      m8: m8,\n      m9: m9,\n      m10: m10,\n      m11: m11,\n      m12: m12,\n      m13: m13,\n      m14: m14,\n      m15: m15,\n      m16: m16,\n      m17: m17,\n      m18: m18,\n      m19: m19,\n      m20: m20,\n      m21: m21\n    }\n  })\n\n  if (!_vm._isMounted) {\n    _vm.e0 = function($event) {\n      _vm.isFocus = true\n    }\n\n    _vm.e1 = function($event) {\n      _vm.isFocus = false\n    }\n  }\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./room.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./room.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<view class=\"content\" @touchstart=\"hideDrawer\">\r\n\t\t\t<!-- <scroll-view class=\"msg-list\" scroll-y=\"true\" :scroll-with-animation=\"scrollAnimation\" :scroll-top=\"scrollTop\"\r\n\t\t\t :scroll-into-view=\"scrollToView\" @scrolltoupper=\"loadHistory\" upper-threshold=\"50\"> -->\r\n\t\t\t <view class=\"msg-list\">\r\n\t\t\t\t<view class=\"msg-list1\">\r\n\t\t\t\t<!-- 加载历史数据waitingUI -->\r\n\t\t\t\t<view class=\"loading\" v-if=\"isHistoryLoading\">\r\n\t\t\t\t\t<view class=\"spinner\">\r\n\t\t\t\t\t\t<view class=\"rect1\"></view>\r\n\t\t\t\t\t\t<view class=\"rect2\"></view>\r\n\t\t\t\t\t\t<view class=\"rect3\"></view>\r\n\t\t\t\t\t\t<view class=\"rect4\"></view>\r\n\t\t\t\t\t\t<view class=\"rect5\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"row\" v-for=\"(item,index) in msgList\" :key=\"index\" :id=\"item.ID\">\r\n\t\t\t\t\t<!-- 用户消息 -->\r\n\t\t\t\t\t<block>\r\n\t\t\t\t\t\t<!-- 自己发出的消息 -->\r\n\t\t\t\t\t\t<view class=\"my\" v-if=\"item.flow=='out'\">\r\n\t\t\t\t\t\t\t<!-- 左-消息 -->\r\n\t\t\t\t\t\t\t<view class=\"left\">\r\n\t\t\t\t\t\t\t\t<!-- 文字消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"item.type==TIM.TYPES.MSG_TEXT\" class=\"bubble\">\r\n\t\t\t\t\t\t\t\t\t<rich-text :nodes=\"nodesFliter(item.payload.text)\"></rich-text>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 图片消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"item.type==TIM.TYPES.MSG_IMAGE\" class=\"bubble\">\r\n\t\t\t\t\t\t\t\t\t<image @tap=\"previmg\" :data-url=\"item.payload.imageInfoArray[0].imageUrl\"\r\n\t\t\t\t\t\t\t\t\t :src=\"item.payload.imageInfoArray[0].imageUrl\" mode=\"aspectFill\"\r\n\t\t\t\t\t\t\t\t\t\tstyle=\"width: 64px;height: 64px;\"></image>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 自定义消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"item.type==TIM.TYPES.MSG_CUSTOM\" class=\"bubble\">\r\n\t\t\t\t\t\t\t\t\t<view v-if=\"item.payload.data=='custom'\">{{item.payload.data}}</view>\r\n\t\t\t\t\t\t\t\t\t<view v-if=\"item.payload.data=='custom'\">{{item.payload.description}}</view>\r\n\t\t\t\t\t\t\t\t\t<view v-if=\"item.payload.data=='custom'\">{{item.payload.extension}}</view>\r\n\t\t\t\t\t\t\t\t\t<view v-if=\"item.payload.data=='custom1'\">\r\n\t\t\t\t\t\t\t\t\t\t<!-- {{JSON.parse(item.payload.extension)}} -->\r\n\t\t\t\t\t\t\t\t\t\t{{'自定义参数1:'+getarg(item.payload.extension,'a',item.payload.data)}}\r\n\t\t\t\t\t\t\t\t\t\t{{'自定义参数2:'+getarg(item.payload.extension,'a1',item.payload.data)}}\r\n\t\t\t\t\t\t\t\t\t\t{{'自定义参数3:'+getarg(item.payload.extension,'a2',item.payload.data)}}\r\n\t\t\t\t\t\t\t\t\t\t{{'自定义参数4:'+getarg(item.payload.extension,'a3',item.payload.data)}}\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t<view v-if=\"item.payload.data=='custom_good'\"  class=\"chat_box\" @tap=\"jump\" :data-url=\"getarg(item.payload.extension,'a2',item.payload.data)\">\r\n\t\t\t\t\t\t\t\t\t\t<image class=\"chat_img\" :src=\"getarg(item.payload.extension,'a3',item.payload.data)\"\r\n\t\t\t\t\t\t\t\t\t\t mode=\"aspectFill\" style=\"width: 64px;height: 64px;\"></image>\r\n\t\t\t\t\t\t\t\t\t\t<view class=\"chat_msg\">\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"gb_name oh1\">{{item.payload.description}}</view>\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"gb_msg  oh1\">{{'自定义参数1:'+getarg(item.payload.extension,'a',item.payload.data)}}</view>\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"gb_msg oh1\">{{'自定义参数2:'+getarg(item.payload.extension,'a1',item.payload.data)}}</view>\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"gb_msg oh1\">{{'自定义参数3:'+getarg(item.payload.extension,'a2',item.payload.data)}}</view>\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<!-- 右-头像 -->\r\n\t\t\t\t\t\t\t<view class=\"right\">\r\n\t\t\t\t\t\t\t\t<image :src=\"loginMsg.avatarurl\"></image>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<!-- 别人发出的消息 -->\r\n\t\t\t\t\t\t<view class=\"other\" v-else>\r\n\t\t\t\t\t\t\t<!-- 左-头像 -->\r\n\t\t\t\t\t\t\t<view class=\"left\">\r\n\t\t\t\t\t\t\t\t<image :src=\"toUserInfo.head_portrait\"></image>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<!-- 右-用户名称-时间-消息 -->\r\n\t\t\t\t\t\t\t<view class=\"right\">\r\n\t\t\t\t\t\t\t\t<view class=\"username\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"name\">{{toUserInfo.name}}</view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"time\" v-if=\"index==0\">{{timeFliter(item.time)}}</view>\r\n\t\t\t\t\t\t\t\t\t<!-- <view v-else-if=\"timeFliter(item.time)!=timeFliter(msgList[index-1].time)\"></view> -->\r\n\t\t\t\t\t\t\t\t\t<!-- <view v-else-if=\"index>0\">{{timeFliter(msgList[index-1].time)}}</view> -->\r\n\t\t\t\t\t\t\t\t\t<view v-else-if=\"index>0\">{{gettime1(index-1)}}</view>\r\n\t\t\t\t\t\t\t\t\t<view style=\"color: rgba(0,0,0,0);\">{{toUserInfo.name}}</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 文字消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"item.type==TIM.TYPES.MSG_TEXT\" class=\"bubble\">\r\n\t\t\t\t\t\t\t\t\t<rich-text :nodes=\"nodesFliter(item.payload.text)\"></rich-text>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 图片消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"item.type==TIM.TYPES.MSG_IMAGE\" class=\"bubble\">\r\n\t\t\t\t\t\t\t\t\t<image @tap=\"previmg\" :data-url=\"item.payload.imageInfoArray[0].imageUrl\"\r\n\t\t\t\t\t\t\t\t\t :src=\"item.payload.imageInfoArray[0].imageUrl\" mode=\"aspectFill\"\r\n\t\t\t\t\t\t\t\t\t\tstyle=\"width: 64px;height: 64px;\"></image>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<view v-if=\"item.type==TIM.TYPES.MSG_CUSTOM\" class=\"bubble\">\r\n\t\t\t\t\t\t\t\t\t<view v-if=\"item.payload.data=='custom'\">{{item.payload.data}}</view>\r\n\t\t\t\t\t\t\t\t\t<view v-if=\"item.payload.data=='custom'\">{{item.payload.description}}</view>\r\n\t\t\t\t\t\t\t\t\t<view v-if=\"item.payload.data=='custom'\">{{item.payload.extension}}</view>\r\n\t\t\t\t\t\t\t\t\t<view v-if=\"item.payload.data=='custom1'\">\r\n\t\t\t\t\t\t\t\t\t\t<!-- {{JSON.parse(item.payload.extension)}} -->\r\n\t\t\t\t\t\t\t\t\t\t{{'自定义参数1:'+getarg(item.payload.extension,'a',item.payload.data)}}\r\n\t\t\t\t\t\t\t\t\t\t{{'自定义参数2:'+getarg(item.payload.extension,'a1',item.payload.data)}}\r\n\t\t\t\t\t\t\t\t\t\t{{'自定义参数3:'+getarg(item.payload.extension,'a2',item.payload.data)}}\r\n\t\t\t\t\t\t\t\t\t\t{{'自定义参数4:'+getarg(item.payload.extension,'a3',item.payload.data)}}\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t<view v-if=\"item.payload.data=='custom_good'\"  class=\"chat_box\" @tap=\"jump\" :data-url=\"getarg(item.payload.extension,'a2',item.payload.data)\">\r\n\t\t\t\t\t\t\t\t\t\t<image class=\"chat_img\" :src=\"getarg(item.payload.extension,'a3',item.payload.data)\"\r\n\t\t\t\t\t\t\t\t\t\t mode=\"aspectFill\" style=\"width: 64px;height: 64px;\"></image>\r\n\t\t\t\t\t\t\t\t\t\t<view class=\"chat_msg\">\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"gb_name oh1\">{{item.payload.description}}</view>\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"gb_msg oh1\">{{'自定义参数1:'+getarg(item.payload.extension,'a',item.payload.data)}}</view>\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"gb_msg oh1\">{{'自定义参数2:'+getarg(item.payload.extension,'a1',item.payload.data)}}</view>\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"gb_msg oh1\">{{'自定义参数3:'+getarg(item.payload.extension,'a2',item.payload.data)}}</view>\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</block>\r\n\t\t\t\t</view>\r\n\t\t\t<!-- </scroll-view> -->\r\n\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 抽屉栏 -->\r\n\t\t<view class=\"popup-layer\" :class=\"popupLayerClass\" @touchmove.stop.prevent=\"discard\">\r\n\t\t\t<!-- 表情 -->\r\n\t\t\t<swiper class=\"emoji-swiper\" :class=\"{hidden:hideEmoji}\" indicator-dots=\"true\" duration=\"150\">\r\n\t\t\t\t<swiper-item v-for=\"(page,pid) in emojiList\" :key=\"pid\">\r\n\t\t\t\t\t<view v-for=\"(em,eid) in page\" :key=\"eid\" @tap=\"addEmoji(em)\">\r\n\t\t\t\t\t\t<image mode=\"widthFix\" :src=\"filter.imgIP('/static_s/51daiyan/img/emoji/'+em.url)\"></image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</swiper-item>\r\n\t\t\t</swiper>\r\n\t\t\t<!-- 更多功能 相册-拍照-红包 -->\r\n\t\t\t<view class=\"more-layer\" :class=\"{hidden:hideMore}\">\r\n\t\t\t\t<view class=\"list\">\r\n\t\t\t\t\t<view class=\"box\" @tap=\"chooseImage\">\r\n\t\t\t\t\t\t<view class=\"icon tupian2\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"box\" @tap=\"camera\">\r\n\t\t\t\t\t\t<view class=\"icon paizhao\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"box\" @tap=\"handRedEnvelopes\">\r\n\t\t\t\t\t\t<view class=\"icon hongbao\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"box\" @tap=\"customModal\">\r\n\t\t\t\t\t\t<view class=\"iconfont icon-zidingyi\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 底部输入栏 -->\r\n\t\t<view class=\"input-box\" :class=\"popupLayerClass\" @touchmove.stop.prevent=\"discard\">\r\n\t\t\t<!-- H5下不能录音，输入栏布局改动一下 -->\r\n\t\t\t<!-- #ifndef H5 -->\r\n\t\t\t<!-- <view class=\"voice\">\r\n\t\t\t\t<view class=\"icon\" :class=\"isVoice?'jianpan':'yuyin'\" @tap=\"switchVoice\"></view>\r\n\t\t\t</view> -->\r\n\t\t\t<!-- #endif -->\r\n\t\t\t<!-- #ifdef H5 -->\r\n\t\t\t<view class=\"more\" @tap=\"showMore\">\r\n\t\t\t\t<view class=\"icon add\"></view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #endif -->\r\n\t\t\t<view class=\"textbox\">\r\n\t\t\t\t<view class=\"voice-mode\" :class=\"[isVoice?'':'hidden',recording?'recording':'']\" @touchstart=\"voiceBegin\"\r\n\t\t\t\t @touchmove.stop.prevent=\"voiceIng\" @touchend=\"voiceEnd\" @touchcancel=\"voiceCancel\">{{voiceTis}}</view>\r\n\t\t\t\t<view class=\"text-mode\" :class=\"isVoice?'hidden':''\">\r\n\t\t\t\t\t<view class=\"box\" style=\"flex: 1;\">\r\n\t\t\t\t\t\t<!-- <textarea auto-height=\"true\" v-model=\"textMsg\" @focus=\"textareaFocus\" cursor-spacing=\"18\" /> -->\r\n\t\t\t\t\t\t<input type=\"text\"\r\n\t\t\t\t\t\t       class=\"input\"\r\n\t\t\t\t\t\t       v-model=\"textMsg\"\r\n\t\t\t\t\t\t       confirm-type=\"send\"\r\n\t\t\t\t\t\t       :focus=\"isFocus\"\r\n\t\t\t\t\t\t       @focus=\"isFocus = true\"\r\n\t\t\t\t\t\t       @blur=\"isFocus = false\"\r\n\t\t\t\t\t\t       @confirm='sendText'\r\n\t\t\t\t\t\t\t\t\t cursor-spacing=\"18\"/>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"em\" @tap=\"chooseEmoji\">\r\n\t\t\t\t\t\t<view class=\"icon biaoqing\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #ifndef H5 -->\r\n\t\t\t<view class=\"more\" @tap=\"showMore\">\r\n\t\t\t\t<view class=\"icon add\"></view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #endif -->\r\n\t\t\t<view class=\"send\" :class=\"isVoice?'hidden':''\" @tap=\"sendText\">\r\n\t\t\t\t<view class=\"btn\">发送</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 录音UI效果 -->\r\n\t\t<view class=\"record\" :class=\"recording?'':'hidden'\">\r\n\t\t\t<view class=\"ing\" :class=\"willStop?'hidden':''\"><view class=\"icon luyin2\" ></view></view>\r\n\t\t\t<view class=\"cancel\" :class=\"willStop?'':'hidden'\"><view class=\"icon chehui\" ></view></view>\r\n\t\t\t<view class=\"tis\" :class=\"willStop?'change':''\">{{recordTis}}</view>\r\n\t\t</view>\r\n\t\t<!-- 红包弹窗 -->\r\n\t\t<view class=\"windows\" :class=\"windowsState\">\r\n\t\t\t<!-- 遮罩层 -->\r\n\t\t\t<view class=\"mask\" @touchmove.stop.prevent=\"discard\" @tap=\"closeRedEnvelope\"></view>\r\n\t\t\t<view class=\"layer\" @touchmove.stop.prevent=\"discard\">\r\n\t\t\t\t<view class=\"open-redenvelope\">\r\n\t\t\t\t\t<view class=\"top\">\r\n\t\t\t\t\t\t<view class=\"close-btn\">\r\n\t\t\t\t\t\t\t<view class=\"icon close\" @tap=\"closeRedEnvelope\"></view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<image :src=\"filter.imgIP('/static_s/51daiyan/img/im/face/face_1.jpg')\"></image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"from\">来自{{redenvelopeData.from}}</view>\r\n\t\t\t\t\t<view class=\"blessing\">{{redenvelopeData.blessing}}</view>\r\n\t\t\t\t\t<view class=\"money\">{{redenvelopeData.money}}</view>\r\n\t\t\t\t\t<view class=\"showDetails\" @tap=\"toDetails(redenvelopeData.rid)\">\r\n\t\t\t\t\t\t查看领取详情 <view class=\"icon to\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t</view>\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t</view>\r\n</template>\r\n<script module=\"filter\" lang=\"wxs\" src=\"../../utils/filter.wxs\"></script>\r\n<script>\r\n\timport service from '../../service.js';\r\n\timport {\r\n\t\tmapState,\r\n\t\tmapMutations\r\n\t} from 'vuex'\r\n\timport userList from '../../commen/tim/user.js'\r\n\r\n\t\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\t//TIM变量\r\n\t\t\t\tconversationActive:null,\r\n\t\t\t\ttoUserId:'',\r\n\t\t\t\ttoUserInfo:null,\r\n\t\t\t\tuserInfo:null,\r\n\t\t\t\tnextReqMessageID:'',\r\n\t\t\t\tcount:15,\r\n\t\t\t\tisCompleted:'',\r\n\t\t\t\tmsgList:[],\r\n\t\t\t    TIM:null, \r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t//文字消息\r\n\t\t\t\ttextMsg:'',\r\n\t\t\t\t//消息列表\r\n\t\t\t\tisHistoryLoading:false,\r\n\t\t\t\tscrollAnimation:false,\r\n\t\t\t\tscrollTop:0,\r\n\t\t\t\tscrollToView:'',\r\n\t\t\t\r\n\t\t\t\tmsgImgList:[],\r\n\t\t\t\tmyuid:0,\r\n\t\t\t\t\r\n\t\t\t\t//录音相关参数\r\n\t\t\t\t// #ifndef H5\r\n\t\t\t\t//H5不能录音\r\n\t\t\t\tRECORDER:uni.getRecorderManager(),\r\n\t\t\t\t// #endif\r\n\t\t\t\tisVoice:false,\r\n\t\t\t\tvoiceTis:'按住 说话',\r\n\t\t\t\trecordTis:\"手指上滑 取消发送\",\r\n\t\t\t\trecording:false,\r\n\t\t\t\twillStop:false,\r\n\t\t\t\tinitPoint:{identifier:0,Y:0},\r\n\t\t\t\trecordTimer:null,\r\n\t\t\t\trecordLength:0,\r\n\t\t\t\t\r\n\t\t\t\t//播放语音相关参数\r\n\t\t\t\tAUDIO:uni.createInnerAudioContext(),\r\n\t\t\t\tplayMsgid:null,\r\n\t\t\t\tVoiceTimer:null,\r\n\t\t\t\t// 抽屉参数\r\n\t\t\t\tpopupLayerClass:'',\r\n\t\t\t\t// more参数\r\n\t\t\t\thideMore:true,\r\n\t\t\t\t//表情定义\r\n\t\t\t\thideEmoji:true,\r\n\t\t\t\temojiList:this.$commen.emojiList,\r\n\t\t\t\t//表情图片图床名称 ，由于我上传的第三方图床名称会有改变，所以有此数据来做对应，您实际应用中应该不需要\r\n\t\t\t\tonlineEmoji:{\"100.gif\":\"AbNQgA.gif\",\"101.gif\":\"AbN3ut.gif\",\"102.gif\":\"AbNM3d.gif\",\"103.gif\":\"AbN8DP.gif\",\"104.gif\":\"AbNljI.gif\",\"105.gif\":\"AbNtUS.gif\",\"106.gif\":\"AbNGHf.gif\",\"107.gif\":\"AbNYE8.gif\",\"108.gif\":\"AbNaCQ.gif\",\"109.gif\":\"AbNN4g.gif\",\"110.gif\":\"AbN0vn.gif\",\"111.gif\":\"AbNd3j.gif\",\"112.gif\":\"AbNsbV.gif\",\"113.gif\":\"AbNwgs.gif\",\"114.gif\":\"AbNrD0.gif\",\"115.gif\":\"AbNDuq.gif\",\"116.gif\":\"AbNg5F.gif\",\"117.gif\":\"AbN6ET.gif\",\"118.gif\":\"AbNcUU.gif\",\"119.gif\":\"AbNRC4.gif\",\"120.gif\":\"AbNhvR.gif\",\"121.gif\":\"AbNf29.gif\",\"122.gif\":\"AbNW8J.gif\",\"123.gif\":\"AbNob6.gif\",\"124.gif\":\"AbN5K1.gif\",\"125.gif\":\"AbNHUO.gif\",\"126.gif\":\"AbNIDx.gif\",\"127.gif\":\"AbN7VK.gif\",\"128.gif\":\"AbNb5D.gif\",\"129.gif\":\"AbNX2d.gif\",\"130.gif\":\"AbNLPe.gif\",\"131.gif\":\"AbNjxA.gif\",\"132.gif\":\"AbNO8H.gif\",\"133.gif\":\"AbNxKI.gif\",\"134.gif\":\"AbNzrt.gif\",\"135.gif\":\"AbU9Vf.gif\",\"136.gif\":\"AbUSqP.gif\",\"137.gif\":\"AbUCa8.gif\",\"138.gif\":\"AbUkGQ.gif\",\"139.gif\":\"AbUFPg.gif\",\"140.gif\":\"AbUPIS.gif\",\"141.gif\":\"AbUZMn.gif\",\"142.gif\":\"AbUExs.gif\",\"143.gif\":\"AbUA2j.gif\",\"144.gif\":\"AbUMIU.gif\",\"145.gif\":\"AbUerq.gif\",\"146.gif\":\"AbUKaT.gif\",\"147.gif\":\"AbUmq0.gif\",\"148.gif\":\"AbUuZV.gif\",\"149.gif\":\"AbUliF.gif\",\"150.gif\":\"AbU1G4.gif\",\"151.gif\":\"AbU8z9.gif\",\"152.gif\":\"AbU3RJ.gif\",\"153.gif\":\"AbUYs1.gif\",\"154.gif\":\"AbUJMR.gif\",\"155.gif\":\"AbUadK.gif\",\"156.gif\":\"AbUtqx.gif\",\"157.gif\":\"AbUUZ6.gif\",\"158.gif\":\"AbUBJe.gif\",\"159.gif\":\"AbUdIO.gif\",\"160.gif\":\"AbU0iD.gif\",\"161.gif\":\"AbUrzd.gif\",\"162.gif\":\"AbUDRH.gif\",\"163.gif\":\"AbUyQA.gif\",\"164.gif\":\"AbUWo8.gif\",\"165.gif\":\"AbU6sI.gif\",\"166.gif\":\"AbU2eP.gif\",\"167.gif\":\"AbUcLt.gif\",\"168.gif\":\"AbU4Jg.gif\",\"169.gif\":\"AbURdf.gif\",\"170.gif\":\"AbUhFS.gif\",\"171.gif\":\"AbU5WQ.gif\",\"172.gif\":\"AbULwV.gif\",\"173.gif\":\"AbUIzj.gif\",\"174.gif\":\"AbUTQs.gif\",\"175.gif\":\"AbU7yn.gif\",\"176.gif\":\"AbUqe0.gif\",\"177.gif\":\"AbUHLq.gif\",\"178.gif\":\"AbUOoT.gif\",\"179.gif\":\"AbUvYF.gif\",\"180.gif\":\"AbUjFU.gif\",\"181.gif\":\"AbaSSJ.gif\",\"182.gif\":\"AbUxW4.gif\",\"183.gif\":\"AbaCO1.gif\",\"184.gif\":\"Abapl9.gif\",\"185.gif\":\"Aba9yR.gif\",\"186.gif\":\"AbaFw6.gif\",\"187.gif\":\"Abaiex.gif\",\"188.gif\":\"AbakTK.gif\",\"189.gif\":\"AbaZfe.png\",\"190.gif\":\"AbaEFO.gif\",\"191.gif\":\"AbaVYD.gif\",\"192.gif\":\"AbamSH.gif\",\"193.gif\":\"AbaKOI.gif\",\"194.gif\":\"Abanld.gif\",\"195.gif\":\"Abau6A.gif\",\"196.gif\":\"AbaQmt.gif\",\"197.gif\":\"Abal0P.gif\",\"198.gif\":\"AbatpQ.gif\",\"199.gif\":\"Aba1Tf.gif\",\"200.png\":\"Aba8k8.png\",\"201.png\":\"AbaGtS.png\",\"202.png\":\"AbaJfg.png\",\"203.png\":\"AbaNlj.png\",\"204.png\":\"Abawmq.png\",\"205.png\":\"AbaU6s.png\",\"206.png\":\"AbaaXn.png\",\"207.png\":\"Aba000.png\",\"208.png\":\"AbarkT.png\",\"209.png\":\"AbastU.png\",\"210.png\":\"AbaB7V.png\",\"211.png\":\"Abafn1.png\",\"212.png\":\"Abacp4.png\",\"213.png\":\"AbayhF.png\",\"214.png\":\"Abag1J.png\",\"215.png\":\"Aba2c9.png\",\"216.png\":\"AbaRXR.png\",\"217.png\":\"Aba476.png\",\"218.png\":\"Abah0x.png\",\"219.png\":\"Abdg58.png\"},\r\n\t\t\t\t//红包相关参数\r\n\t\t\t\twindowsState:'',\r\n\t\t\t\tredenvelopeData:{\r\n\t\t\t\t\trid:null,\t//红包ID\r\n\t\t\t\t\tfrom:null,\r\n\t\t\t\t\tface:null,\r\n\t\t\t\t\tblessing:null,\r\n\t\t\t\t\tmoney:null\r\n\t\t\t\t},\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tcustomModalVisible: false,\r\n\t\t\t\tcustomData: '',\r\n\t\t\t\tcustomDescription: '',\r\n\t\t\t\tcustomExtension: '',\r\n\t\t\t\tfocusedInput: '',\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tisShow: false,\r\n\t\t\t};\r\n\t\t},\r\n\t\tcomputed:{\r\n\t\t\t...mapState({\r\n\t\t\t\tloginMsg:'loginMsg',\r\n\t\t\t\thasLogin:'hasLogin',\r\n\t\t\t\tcurrentMessageList:state=>state.currentMessageList,\r\n\t\t\t})\r\n\t\t},\r\n\t\twatch:{\r\n\t\t\tcurrentMessageList(newVal,oldVal){\r\n\t\t\t\tthis.msgList = newVal\r\n\t\t\t\tthis.screenMsg(newVal,oldVal)\r\n\t\t\t},\r\n\t\t},\r\n\t\tonLoad(option) {\r\n\t\t\tconsole.log(option.id)\r\n\t\t\tif(!this.hasLogin){\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\t// if(typeof uni.getStorageSync('userInfo')=='string'){\r\n\t\t\t// \t\tthis.userInfo = JSON.parse(uni.getStorageSync('userInfo'))\r\n\t\t\t// }\r\n\t\t\t\r\n\t\t\tthis.toUserId =option.id?option.id: this.$store.state.toUserId\r\n\t\t\tthis.conversationActive = this.$store.state.conversationActive\r\n\t\t\tthis.TIM = this.$TIM\r\n\t\t\t//获取聊天对象的用户信息---有后端的情况这里 使用后端api请求、\r\n\t\t\t//防止初次聊天的时候 没有对方的基础信息\r\n\t\t\tthis.getmsg()\r\n\t\t\tthis.getMsgList();\r\n\t\t\t//语音自然播放结束\r\n\t\t\tthis.AUDIO.onEnded((res)=>{\r\n\t\t\t\tthis.playMsgid=null;\r\n\t\t\t});\r\n\t\t\t// #ifndef H5\r\n\t\t\t//录音开始事件\r\n\t\t\tthis.RECORDER.onStart((e)=>{\r\n\t\t\t\tthis.recordBegin(e);\r\n\t\t\t})\r\n\t\t\t//录音结束事件\r\n\t\t\tthis.RECORDER.onStop((e)=>{\r\n\t\t\t\tthis.recordEnd(e);\r\n\t\t\t})\r\n\t\t\t// #endif\r\n\t\t},\r\n\t\tonShow(){\r\n\t\t\tvar that =this\r\n\t\t\tthat.isShow = true\r\n\t\t\tsetTimeout(function (){\r\n\t\t\t\tthat.scrollToBottom()\r\n\t\t\t\tthat.scrollTop = 99999999999999;\r\n\t\t\t\tthat.isHistoryLoading = false;\r\n\t\t\t},500)\r\n\t\t},\r\n\t\tonUnload(){\r\n\t\t\t//退出页面 将所有的会话内的消息设置为已读\r\n\t\t\tlet promise = this.tim.setMessageRead({conversationID: this.conversationActive.conversationID});\r\n\t\t\tpromise.then(function(imResponse) {\r\n\t\t\t\tconsole.log('全部已读')\r\n\t\t\t  // 已读上报成功\r\n\t\t\t}).catch(function(imError) {\r\n\t\t\t  // 已读上报失败\r\n\t\t\t  console.warn('setMessageRead error:', imError);\r\n\t\t\t});\r\n\t\t},\r\n\t\tonPullDownRefresh() {\r\n\t\t\tuni.stopPullDownRefresh();\r\n\t\t},\r\n\t\tmethods:{\r\n\t\t\tgetmsg(){\r\n\t\t\t\tvar that = this\r\n\t\t\t\tvar datas = {\r\n\t\t\t\t\ttoken: that.loginMsg.userToken,\r\n\t\t\t\t\tid: that.toUserId\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 单个请求\r\n\t\t\t\tservice.P_get('/getTx', datas).then(res => {\r\n\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\tif (res.code == 1) {\r\n\t\t\t\t\t\tthat.toUserInfo = res.data\r\n\t\t\t\t\t\tuni.setNavigationBarTitle({\r\n\t\t\t\t\t\t\ttitle:res.data.name\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(e => {\r\n\t\t\t\t\tconsole.log(e)\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\ttitle: '获取对方数据失败'\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tgettime1(idx){\r\n\t\t\t\tif(idx<0){\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log(idx,idx+1)\r\n\t\t\t\tvar time=this.msgList[idx].time\r\n\t\t\t\tvar time1=this.msgList[idx+1].time\r\n\t\t\t\tconsole.log(this.getchattime(time),this.getchattime(time1))\r\n\t\t\t\tif(this.getchattime(time)!=this.getchattime(time1)){\r\n\t\t\t\t\treturn this.getchattime(time1)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tjump(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl:e.currentTarget.dataset.url\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tonPullDownRefresh: function () {\r\n\t\t\t  uni.stopPullDownRefresh();\r\n\t\t\t},\r\n\t\t\t// 滚动到列表bottom\r\n\t\t\tscrollToBottom () {\r\n\t\t\t  if (this.isShow) {\r\n\t\t\t    wx.pageScrollTo({\r\n\t\t\t      scrollTop: 9999999\r\n\t\t\t    })\r\n\t\t\t  }\r\n\t\t\t},\r\n\t\t\tgetarg(str,arg,type){\r\n\t\t\t\tif(type=='custom'){\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tif(!str){\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t// console.log(str)\r\n\t\t\t\tvar reg = /\\\\$/gi\r\n\t\t\t\tstr = str.replace(reg, '')\r\n\t\t\t\t// console.log(str)\r\n\t\t\t\tvar jsonstr=JSON.parse(str)\r\n\t\t\t\t// console.log(jsonstr)\r\n\t\t\t\tif(jsonstr.hasOwnProperty(arg)){\r\n\t\t\t\t\r\n\t\t\t\t\t// console.log(jsonstr[arg]);\r\n\t\t\t\t\treturn jsonstr[arg]\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t//聊天的节点加上外层的div\r\n\t\t\tnodesFliter(str){\r\n\t\t\t\tlet nodeStr = '<div class=\"ltbox_div\" style=\"word-wrap:break-word;line-height:40upx;\">'+str+'</div>' \r\n\t\t\t\treturn nodeStr\r\n\t\t\t},\r\n\t\t\t//时间过滤\r\n\t\t\ttimeFliter(timer){\r\n\t\t\t\tlet timeData = new Date(timer*1000)\r\n\t\t\t\tlet str = this.$commen.dateTimeFliter(timeData)\t\t \r\n\t\t\t\treturn str\r\n\t\t\t},\r\n\t\t\tgetchattime(time) {\r\n\t\t\t  if (!time) {\r\n\t\t\t    return\r\n\t\t\t  }\r\n\t\t\t  var newYear = new Date().getFullYear();//目前系统时间是哪一年\r\n\t\t\t  var nowMonth = new Date().getMonth() + 1;//目前系统时间是哪一月\r\n\t\t\t  var nowDay = new Date().getDate();//目前系统时间是几号\r\n\t\t\t  time = Number(time*1000)\r\n\t\t\t  var sendtime = new Date(time)\r\n\t\t\t  var sendYear = sendtime.getFullYear()\r\n\t\t\t  var sendMonth = sendtime.getMonth() + 1\r\n\t\t\t  var sendDate = sendtime.getDate()\r\n\t\t\t  var sendHours = sendtime.getHours()\r\n\t\t\t  var sendMinutes = sendtime.getMinutes()\r\n\t\t\t  if (sendMinutes < 10) {\r\n\t\t\t    sendMinutes = '0' + sendMinutes\r\n\t\t\t  }\r\n\t\t\t  // console.log(time)\r\n\t\t\t  console.log(sendtime)\r\n\t\t\t  // console.log(sendtime.getDate())\r\n\t\t\t  if (sendYear == newYear) {\r\n\t\t\t\r\n\t\t\t    // console.log(sendDate, nowDay)\r\n\t\t\t    if (sendMonth==nowMonth&&sendDate == nowDay) {\r\n\t\t\t\r\n\t\t\t      return sendHours + ':' + sendMinutes\r\n\t\t\t    }\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t    return sendMonth + '-' + sendDate + ' ' + sendHours + ':' + sendMinutes\r\n\t\t\t  } else {\r\n\t\t\t    return sendYear + '-' + sendMonth + '-' + sendDate + ' ' + sendHours + ':' + sendMinutes\r\n\t\t\t  }\r\n\t\t\t},\r\n\t\t\t// 接受消息(定位消息)\r\n\t\t\tscreenMsg(newVal,oldVal){\r\n\t\t\t\tif(newVal[0] && oldVal[0]){\r\n\t\t\t\t\tif(newVal[0].ID != oldVal[0].ID && newVal.length>=this.count ){\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet _index = newVal.length-oldVal.length-1\r\n\t\t\t\t\t\tthis.$nextTick(()=> {this.scrollToView =newVal[_index].ID});\r\n\t\t\t\t\t\t// console.log(this.scrollToView)\r\n\t\t\t\t\t\t//拉取历史记录不用改变定位消息\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t//新的消息来了 自动向下滑动到最新消息\r\n\t\t\t\t\t\tthis.$nextTick(()=> {this.scrollToView =newVal[newVal.length-1].ID});\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tconsole.log('*****')\r\n\t\t\t\t\t//第一次拉取历史记录 定位到最后一条消息\r\n\t\t\t\t\tthis.$nextTick(()=> {this.scrollToView =newVal[newVal.length-1].ID;this.scrollTop = 9999999;});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t//触发滑动到顶部(加载历史信息记录)\r\n\t\t\tloadHistory(e){\r\n\t\t\t\t\tthis.isHistoryLoading = true;\r\n\t\t\t\t\t// 更多消息列表\r\n\t\t\t\t\t\tlet conversationID = this.conversationActive.conversationID\r\n\t\t\t\t\t\tlet promise = this.tim.getMessageList({conversationID: conversationID,nextReqMessageID:this.nextReqMessageID,count: this.count});\r\n\t\t\t\t\t\tpromise.then((res)=> {\r\n\t\t\t\t\t\t  this.$store.commit('unshiftCurrentMessageList',  res.data.messageList)\r\n\t\t\t\t\t\t  this.nextReqMessageID =  res.data.nextReqMessageID // 用于续拉，分页续拉时需传入该字段。\r\n\t\t\t\t\t\t  this.isCompleted =  res.data.isCompleted\r\n\t\t\t\t\t\t  this.isHistoryLoading = false;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\t// //这段代码很重要，不然每次加载历史数据都会跳到顶部\r\n\t\t\t\t\t// this.$nextTick(function() {\r\n\t\t\t\t\t// \tthis.scrollToView = this.nextReqMessageID;//跳转上次的第一行信息位置\r\n\t\t\t\t\t// \tthis.$nextTick(function() {\r\n\t\t\t\t\t// \t\tthis.scrollAnimation = true;//恢复滚动动画\r\n\t\t\t\t\t// \t});\t\r\n\t\t\t\t\t// });\r\n\t\t\t\t\t\r\n\t\t\t},\r\n\t\t\t// 加载初始页面消息\r\n\t\t\tgetMsgList(){\r\n\t\t\t\t// 历史消息列表\r\n\t\t\t\t\tlet conversationID = this.conversationActive.conversationID\r\n\t\t\t\t\tlet promise = this.tim.getMessageList({conversationID: conversationID, count: this.count});\r\n\t\t\t\t\tpromise.then((res)=> {\r\n\t\t\t\t\t\tconsole.log(res.data)\r\n\t\t\t\t\t\tif(!res.data.nextReqMessageID){\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.$store.commit('pushCurrentMessageList',  res.data.messageList)\r\n\t\t\t\t\t  this.nextReqMessageID =  res.data.nextReqMessageID // 用于续拉，分页续拉时需传入该字段。\r\n\t\t\t\t\t  this.isCompleted =  res.data.isCompleted\r\n\t\t\t\t\t  this.scrollToView = res.data.messageList[res.data.messageList.length-1].ID\r\n\t\t\t\t\t});\r\n\t\t\t\t// 滚动到底部\r\n\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t//进入页面滚动到底部\r\n\t\t\t\t\tthis.scrollTop = 9999;\r\n\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\tthis.scrollAnimation = true;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t//处理图片尺寸，如果不处理宽高，新进入页面加载图片时候会闪\r\n\t\t\tsetPicSize(content){\r\n\t\t\t\t// 让图片最长边等于设置的最大长度，短边等比例缩小，图片控件真实改变，区别于aspectFit方式。\r\n\t\t\t\tlet maxW = uni.upx2px(350);//350是定义消息图片最大宽度\r\n\t\t\t\tlet maxH = uni.upx2px(350);//350是定义消息图片最大高度\r\n\t\t\t\tif(content.w>maxW||content.h>maxH){\r\n\t\t\t\t\tlet scale = content.w/content.h;\r\n\t\t\t\t\tcontent.w = scale>1?maxW:maxH*scale;\r\n\t\t\t\t\tcontent.h = scale>1?maxW/scale:maxH;\r\n\t\t\t\t}\r\n\t\t\t\treturn content;\r\n\t\t\t},\r\n\t\t\t//更多功能(点击+弹出) \r\n\t\t\tshowMore(){\r\n\t\t\t\tthis.isVoice = false;\r\n\t\t\t\tthis.hideEmoji = true;\r\n\t\t\t\tif(this.hideMore){\r\n\t\t\t\t\tthis.hideMore = false;\r\n\t\t\t\t\tthis.openDrawer();\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.hideDrawer();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 打开抽屉\r\n\t\t\topenDrawer(){\r\n\t\t\t\tthis.popupLayerClass = 'showLayer';\r\n\t\t\t},\r\n\t\t\t// 隐藏抽屉\r\n\t\t\thideDrawer(){\r\n\t\t\t\tthis.popupLayerClass = '';\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\tthis.hideMore = true;\r\n\t\t\t\t\tthis.hideEmoji = true;\r\n\t\t\t\t},150);\r\n\t\t\t},\r\n\t\t\t// 选择图片发送\r\n\t\t\tchooseImage(){\r\n\t\t\t\tthis.getImage('album');\r\n\t\t\t},\r\n\t\t\t//拍照发送\r\n\t\t\tcamera(){\r\n\t\t\t\tthis.getImage('camera');\r\n\t\t\t},\r\n\t\t\t//发红包\r\n\t\t\thandRedEnvelopes(){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl:'HM-hand/HM-hand'\r\n\t\t\t\t});\r\n\t\t\t\tthis.hideDrawer();\r\n\t\t\t},\r\n\t\t\t//选照片 or 拍照\r\n\t\t\tgetImage(type){\r\n\t\t\t\tvar that =this\r\n\t\t\t\tthat.hideDrawer();\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\tsourceType:[type],\r\n\t\t\t\t\tsizeType: ['original', 'compressed'], //可以指定是原图还是压缩图，默认二者都有\r\n\t\t\t\t\tcount: 1,\r\n\t\t\t\t\tsuccess: (res)=>{\r\n\t\t\t\t\t\tthat.sendMsg(res,'img');\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t/*for(let i=0;i<res.tempFilePaths.length;i++){\r\n\t\t\t\t\t\t\tuni.getImageInfo({\r\n\t\t\t\t\t\t\t\tsrc: res.tempFilePaths[i],\r\n\t\t\t\t\t\t\t\tsuccess: (image)=>{\r\n\t\t\t\t\t\t\t\t\tconsole.log(image)\r\n\t\t\t\t\t\t\t\t\tconsole.log(image.width);\r\n\t\t\t\t\t\t\t\t\tconsole.log(image.height);\r\n\t\t\t\t\t\t\t\t\tlet msg = {url:res.tempFilePaths[i],w:image.width,h:image.height};\r\n\t\t\t\t\t\t\t\t\tthat.sendMsg(msg,'img');\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}*/\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 选择表情\r\n\t\t\tchooseEmoji(){\r\n\t\t\t\tthis.hideMore = true;\r\n\t\t\t\tif(this.hideEmoji){\r\n\t\t\t\t\tthis.hideEmoji = false;\r\n\t\t\t\t\tthis.openDrawer();\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.hideDrawer();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t//添加表情\r\n\t\t\taddEmoji(em){\r\n\t\t\t\tthis.textMsg+=em.alt;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t//获取焦点，如果不是选表情ing,则关闭抽屉\r\n\t\t\ttextareaFocus(){\r\n\t\t\t\tif(this.popupLayerClass=='showLayer' && this.hideMore == false){\r\n\t\t\t\t\tthis.hideDrawer();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 发送文字消息\r\n\t\t\tsendText(){\r\n\t\t\t\tthis.hideDrawer();//隐藏抽屉\r\n\t\t\t\tif(!this.textMsg){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet content = this.replaceEmoji(this.textMsg);\r\n\t\t\t\tlet msg = {text:content}\r\n\t\t\t\tthis.sendMsg(msg,'text');\r\n\t\t\t\tthis.textMsg = '';//清空输入框\r\n\t\t\t},\r\n\t\t\t//替换表情符号为图片\r\n\t\t\treplaceEmoji(str){\r\n\t\t\t\tlet replacedStr = str.replace(/\\[([^(\\]|\\[)]*)\\]/g,(item, index)=>{\r\n\t\t\t\t\tconsole.log(\"item: \" + item);\r\n\t\t\t\t\tfor(let i=0;i<this.emojiList.length;i++){\r\n\t\t\t\t\t\tlet row = this.emojiList[i];\r\n\t\t\t\t\t\tfor(let j=0;j<row.length;j++){\r\n\t\t\t\t\t\t\tlet EM = row[j];\r\n\t\t\t\t\t\t\tif(EM.alt==item){\r\n\t\t\t\t\t\t\t\t//在线表情路径，图文混排必须使用网络路径，请上传一份表情到你的服务器后再替换此路径 \r\n\t\t\t\t\t\t\t\t//比如你上传服务器后，你的100.gif路径为https://www.xxx.com/emoji/100.gif 则替换onlinePath填写为https://www.xxx.com/emoji/\r\n\t\t\t\t\t\t\t\tlet onlinePath = 'http://51daiyan.test.upcdn.net/static_s/51daiyan/img/emoji/'\r\n\t\t\t\t\t\t\t\t// let imgstr = '<img class=\"emoji_i\" src=\"'+onlinePath+this.onlineEmoji[EM.url]+'\">';\r\n\t\t\t\t\t\t\t\tlet imgstr = '<img class=\"emoji_i\" src=\"'+onlinePath+EM.url+'\">';\r\n\t\t\t\t\t\t\t\tconsole.log(\"imgstr: \" + imgstr);\r\n\t\t\t\t\t\t\t\treturn imgstr;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\treturn replacedStr;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 发送消息\r\n\t\t\tsendMsg(content,type){\r\n\t\t\t\tconsole.log('????')\r\n\t\t\t\tlet message\r\n\t\t\t\tconsole.log(type)\r\n\t\t\t\tif(type=='custom'){\r\n\t\t\t\t\tmessage = this.tim.createCustomMessage({\r\n\t\t\t\t\t  to: this.toUserId,\r\n\t\t\t\t\t  conversationType: 'C2C',\r\n\t\t\t\t\t  payload: {\r\n\t\t\t\t\t   data: content.data,//自定义消息的数据字段\r\n\t\t\t\t\t   description: content.description,//自定义消息的说明字段\r\n\t\t\t\t\t   extension: content.extension,//自定义消息的扩展字段\r\n\t\t\t\t\t  }\r\n\t\t\t\t\t});\t\r\n\t\t\t\t}else\tif(type=='img'){\r\n\t\t\t\t\tmessage = this.tim.createImageMessage({\r\n\t\t\t\t\t  to: this.toUserId,\r\n\t\t\t\t\t  conversationType: 'C2C',\r\n\t\t\t\t\t  payload: {\r\n\t\t\t\t\t    file: content\r\n\t\t\t\t\t  }\r\n\t\t\t\t\t});\t\r\n\t\t\t\t}else{\r\n\t\t\t\t\tmessage = this.tim.createTextMessage({\r\n\t\t\t\t\t  to: this.toUserId,\r\n\t\t\t\t\t  conversationType: 'C2C',\r\n\t\t\t\t\t  payload: {\r\n\t\t\t\t\t    text: content.text\r\n\t\t\t\t\t  }\r\n\t\t\t\t\t});\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconsole.log('????1')\r\n\t\t\t\tthis.$store.commit('pushCurrentMessageList', message)\r\n\t\t\t\tlet pomise = this.tim.sendMessage(message)\r\n\t\t\t\tpomise.then(\r\n\t\t\t\t\t(res)=>{\r\n\t\t\t\t\t\tthis.$nextTick(()=> {\r\n\t\t\t\t\t\t\t// 滚动到底\r\n\t\t\t\t\t\t\tthis.scrollToView = res.data.message.ID\r\n\t\t\t\t\t\t\tthis.scrollToBottom()\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t(err)=>{\r\n\t\t\t\t\t\tconsole.log(err)\r\n\t\t\t\t\t}\r\n\t\t\t\t)\t\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 添加文字消息到列表\r\n\t\t\taddTextMsg(msg){\r\n\t\t\t\tthis.msgList.push(msg);\r\n\t\t\t},\r\n\t\t\t// 添加语音消息到列表\r\n\t\t\taddVoiceMsg(msg){\r\n\t\t\t\tthis.msgList.push(msg);\r\n\t\t\t},\r\n\t\t\t// 添加图片消息到列表\r\n\t\t\taddImgMsg(msg){\r\n\t\t\t\tmsg.msg.content = this.setPicSize(msg.msg.content);\r\n\t\t\t\tthis.msgImgList.push(msg.msg.content.url);\r\n\t\t\t\tthis.msgList.push(msg);\r\n\t\t\t},\r\n\t\t\taddRedEnvelopeMsg(msg){\r\n\t\t\t\tthis.msgList.push(msg);\r\n\t\t\t},\r\n\t\t\t// 添加系统文字消息到列表\r\n\t\t\taddSystemTextMsg(msg){\r\n\t\t\t\tthis.msgList.push(msg);\r\n\t\t\t},\r\n\t\t\t// 添加系统红包消息到列表\r\n\t\t\taddSystemRedEnvelopeMsg(msg){\r\n\t\t\t\tthis.msgList.push(msg);\r\n\t\t\t},\r\n\t\t\t// 打开红包\r\n\t\t\topenRedEnvelope(msg,index){\r\n\t\t\t\tlet rid = msg.content.rid;\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle:'加载中...'\r\n\t\t\t\t});\r\n\t\t\t\tconsole.log(\"index: \" + index);\r\n\t\t\t\t//模拟请求服务器效果\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t//加载数据\r\n\t\t\t\t\tif(rid==0){\r\n\t\t\t\t\t\tthis.redenvelopeData={\r\n\t\t\t\t\t\t\trid:0,\t//红包ID\r\n\t\t\t\t\t\t\tfrom:\"大黑哥\",\r\n\t\t\t\t\t\t\tface:\"/static/img/im/face/face.jpg\",\r\n\t\t\t\t\t\t\tblessing:\"恭喜发财，大吉大利\",\r\n\t\t\t\t\t\t\tmoney:\"已领完\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis.redenvelopeData={\r\n\t\t\t\t\t\t\trid:1,\t//红包ID\r\n\t\t\t\t\t\t\tfrom:\"售后客服008\",\r\n\t\t\t\t\t\t\tface:\"/static/img/im/face/face_2.jpg\",\r\n\t\t\t\t\t\t\tblessing:\"恭喜发财\",\r\n\t\t\t\t\t\t\tmoney:\"0.01\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(!msg.content.isReceived){\r\n\t\t\t\t\t\t\t// {type:\"system\",msg:{id:8,type:\"redEnvelope\",content:{text:\"你领取了售后客服008的红包\"}}},\r\n\t\t\t\t\t\t\tthis.sendSystemMsg({text:\"你领取了\"+(msg.userinfo.uid==this.myuid?\"自己\":msg.userinfo.username)+\"的红包\"},'redEnvelope');\r\n\t\t\t\t\t\t\tconsole.log(\"this.msgList[index]: \" + JSON.stringify(this.msgList[index]));\r\n\t\t\t\t\t\t\tthis.msgList[index].msg.content.isReceived = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\tthis.windowsState = 'show';\r\n\t\t\t\t\t\r\n\t\t\t\t},200)\t\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 关闭红包弹窗\r\n\t\t\tcloseRedEnvelope(){\r\n\t\t\t\tthis.windowsState = 'hide';\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\tthis.windowsState = '';\r\n\t\t\t\t},200)\r\n\t\t\t},\r\n\t\t\tsendSystemMsg(content,type){\r\n\t\t\t\tlet lastid = this.msgList[this.msgList.length-1].msg.id;\r\n\t\t\t\tlastid++;\r\n\t\t\t\tlet row = {type:\"system\",msg:{id:lastid,type:type,content:content}};\r\n\t\t\t\tthis.screenMsg(row)\r\n\t\t\t},\r\n\t\t\t//领取详情\r\n\t\t\ttoDetails(rid){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl:'HM-details/HM-details?rid='+rid\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 预览图片\r\n\t\t\tshowPic(msg){\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\tindicator:\"none\",\r\n\t\t\t\t\tcurrent:msg.content.url,\r\n\t\t\t\t\turls: this.msgImgList\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 播放语音\r\n\t\t\tplayVoice(msg){\r\n\t\t\t\tthis.playMsgid=msg.id;\r\n\t\t\t\tthis.AUDIO.src = msg.content.url;\r\n\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\tthis.AUDIO.play();\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 录音开始\r\n\t\t\tvoiceBegin(e){\r\n\t\t\t\tif(e.touches.length>1){\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t\tthis.initPoint.Y = e.touches[0].clientY;\r\n\t\t\t\tthis.initPoint.identifier = e.touches[0].identifier;\r\n\t\t\t\tthis.RECORDER.start({format:\"mp3\"});//录音开始,\r\n\t\t\t},\r\n\t\t\t//录音开始UI效果\r\n\t\t\trecordBegin(e){\r\n\t\t\t\tthis.recording = true;\r\n\t\t\t\tthis.voiceTis='松开 结束';\r\n\t\t\t\tthis.recordLength = 0;\r\n\t\t\t\tthis.recordTimer = setInterval(()=>{\r\n\t\t\t\t\tthis.recordLength++;\r\n\t\t\t\t},1000)\r\n\t\t\t},\r\n\t\t\t// 录音被打断\r\n\t\t\tvoiceCancel(){\r\n\t\t\t\tthis.recording = false;\r\n\t\t\t\tthis.voiceTis='按住 说话';\r\n\t\t\t\tthis.recordTis = '手指上滑 取消发送'\r\n\t\t\t\tthis.willStop = true;//不发送录音\r\n\t\t\t\tthis.RECORDER.stop();//录音结束\r\n\t\t\t},\r\n\t\t\t// 录音中(判断是否触发上滑取消发送)\r\n\t\t\tvoiceIng(e){\r\n\t\t\t\tif(!this.recording){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet touche = e.touches[0];\r\n\t\t\t\t//上滑一个导航栏的高度触发上滑取消发送\r\n\t\t\t\tif(this.initPoint.Y - touche.clientY>=uni.upx2px(100)){\r\n\t\t\t\t\tthis.willStop = true;\r\n\t\t\t\t\tthis.recordTis = '松开手指 取消发送'\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.willStop = false;\r\n\t\t\t\t\tthis.recordTis = '手指上滑 取消发送'\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 结束录音\r\n\t\t\tvoiceEnd(e){\r\n\t\t\t\tif(!this.recording){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.recording = false;\r\n\t\t\t\tthis.voiceTis='按住 说话';\r\n\t\t\t\tthis.recordTis = '手指上滑 取消发送'\r\n\t\t\t\tthis.RECORDER.stop();//录音结束\r\n\t\t\t},\r\n\t\t\t//录音结束(回调文件)\r\n\t\t\trecordEnd(e){\r\n\t\t\t\tclearInterval(this.recordTimer);\r\n\t\t\t\tif(!this.willStop){\r\n\t\t\t\t\tconsole.log(\"e: \" + JSON.stringify(e));\r\n\t\t\t\t\tlet msg = {\r\n\t\t\t\t\t\tlength:0,\r\n\t\t\t\t\t\turl:e.tempFilePath\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet min = parseInt(this.recordLength/60);\r\n\t\t\t\t\tlet sec = this.recordLength%60;\r\n\t\t\t\t\tmin = min<10?'0'+min:min;\r\n\t\t\t\t\tsec = sec<10?'0'+sec:sec;\r\n\t\t\t\t\tmsg.length = min+':'+sec;\r\n\t\t\t\t\tthis.sendMsg(msg,'voice');\r\n\t\t\t\t}else{\r\n\t\t\t\t\tconsole.log('取消发送录音');\r\n\t\t\t\t}\r\n\t\t\t\tthis.willStop = false;\r\n\t\t\t},\r\n\t\t\t// 切换语音/文字输入\r\n\t\t\tswitchVoice(){\r\n\t\t\t\tthis.hideDrawer();\r\n\t\t\t\tthis.isVoice = this.isVoice?false:true;\r\n\t\t\t},\r\n\t\t\tdiscard(){\r\n\t\t\t\treturn;\r\n\t\t\t},\r\n\t\t\tcustomModal () {\r\n\t\t\t\tvar that=this\r\n\t\t\t  uni.showModal({\r\n\t\t\t      title: '提示',\r\n\t\t\t      content: '是否发送自定义消息',\r\n\t\t\t      success: function (res) {\r\n\t\t\t          if (res.confirm) {\r\n\t\t\t              console.log('用户点击确定');\r\n\t\t\t\t\t\t\t\t\t\tvar ext={\r\n\t\t\t\t\t\t\t\t\t\t\ta:'a',\r\n\t\t\t\t\t\t\t\t\t\t\ta1:'a1',\r\n\t\t\t\t\t\t\t\t\t\t\ta2:'/pages/index/index',\r\n\t\t\t\t\t\t\t\t\t\t\ta3:'http://119.90.34.147:8080/finance/img/system/touxiang.jpg',\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\text=JSON.stringify(ext)\r\n\t\t\t\t\t\t\t\t\t\tvar msg={\r\n\t\t\t\t\t\t\t\t\t\t\tdata:'custom_good',\r\n\t\t\t\t\t\t\t\t\t\t\tdescription:'自定义消息的说明字段',\r\n\t\t\t\t\t\t\t\t\t\t\textension:ext\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tthat.sendMsg(msg,'custom')\r\n\t\t\t          } else if (res.cancel) {\r\n\t\t\t              console.log('用户点击取消');\r\n\t\t\t          }\r\n\t\t\t      }\r\n\t\t\t  });\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 选项卡关闭\r\n\t\t\thandleClose () {\r\n\t\t\t  this.rateModal = false\r\n\t\t\t  this.isFocus = false\r\n\t\t\t  this.isMoreOpen = false\r\n\t\t\t  this.isEmojiOpen = false\r\n\t\t\t},\r\n\t\t\tprevimg(e){\r\n\t\t\t\tconsole.log(e)\r\n\t\t\t\tvar urls=[]\r\n\t\t\t\turls.push(e.currentTarget.dataset.url)\r\n\t\t\t\t// return\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\t\turls: urls,\r\n\t\t\t\t\t\tlongPressActions: {\r\n\t\t\t\t\t\t\t\titemList: ['发送给朋友', '保存图片', '收藏'],\r\n\t\t\t\t\t\t\t\tsuccess: function(data) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('选中了第' + (data.tapIndex + 1) + '个按钮,第' + (data.index + 1) + '张图片');\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfail: function(err) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log(err.errMsg);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n<style lang=\"scss\">\r\n\t@import \"@/static/HM-chat/css/style.scss\"; \r\n\t.msg-list{\r\n\t\t// padding-bottom: 140px;\r\n\t\t\r\n\t}\r\n\t.msg-list1{\r\n\t\twidth: 100%;\r\n\t\tpadding-bottom: 100upx;\r\n\t}\r\n\t.chat_box{\r\n\t\twidth: 400upx;\r\n\t\tdisplay: flex;\r\n\t}\r\n\t.chat_img{\r\n\t\twidth: 120upx;\r\n\t\theight: 120upx;\r\n\t\tmargin-right: 20upx;\r\n\t}\r\n\t.chat_msg{\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n\t.gb_name{\r\n\t\tfont-size: 28upx;\r\n\t}\r\n\t.gb_msg{\r\n\t\tfont-size: 22upx;\r\n\t}\r\n\t.ltbox_div{\r\n\t\tline-height: 45upx;\r\n\t}\r\n\t.emoji_i{\r\n\t\theight: 40upx;\r\n\t\twidth: 40upx;\r\n\t\tpadding: 2upx;\r\n\t\tbox-sizing: border-box;\r\n\t\tvertical-align: text-bottom;\r\n\t}\r\n</style>\r\n","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./room.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./room.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-filter-loader/index.js!./filter.wxs?vue&type=custom&index=0&blockType=script&issuerPath=E%3A%5CphpStudy%5CWWW%5C41_51daiyan_uni%5Cpages%5Ctim%5Croom.vue&module=filter&lang=wxs\"; export default mod; export * from \"-!../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-filter-loader/index.js!./filter.wxs?vue&type=custom&index=0&blockType=script&issuerPath=E%3A%5CphpStudy%5CWWW%5C41_51daiyan_uni%5Cpages%5Ctim%5Croom.vue&module=filter&lang=wxs\"","export default function (Component) {\n       if(!Component.options.wxsCallMethods){\n         Component.options.wxsCallMethods = []\n       }\n       \n     }"],"sourceRoot":""}